# 🫁 半監督式學習辨識侵襲性肺腫瘤  
> Semi-Supervised Learning for Invasive Lung Tumor Recognition

本專案利用多階段深度學習模型結合影像處理與特徵分析技術，建立一套 **半監督式肺部腫瘤侵襲性辨識系統**，包含肺部分割、結節分割與侵襲性判定三大模組。  

---

## 📁 專案結構總覽

| 模組 | 說明 |
|------|------|
| 🔴 **ResUNet** | 半監督式肺部影像分割模型 (訓練與評估) |
| 🟡 **Lung_Segmentation** | 預測肺部區域，結合 UNet 與 ResUNet 模型 |
| 🟢 **Lung_Nodule_Segmentation** | 肺結節偵測與動態閾值分割 |
| 🔵 **Invasiveness_Recognition** | 特徵擷取、特徵選取與侵襲性預測模型 (BEED 方法) |
| ⚙️ **Full_Version** | 整合所有模組之版本 (部分資料已移除) |

---

## 🔴 ResUNet
> 半監督式學習架構，用於肺部影像分割。

| 檔案 | 功能說明 |
|------|-----------|
| `generate_train_test_data.py` | 將訓練與測試資料轉換為模型輸入格式 |
| `ResUNet.py` | 訓練 ResUNet 模型 |
| `evaluation.py` | 將測試資料輸入訓練後模型進行預測 |
| `metric.py` | 分析模型預測結果的評估指標 |

---

## 🟡 Lung_Segmentation
> 使用兩階段模型預測肺部區域，結合影像處理與深度學習。

| 檔案 | 功能說明 |
|------|-----------|
| `Lung_Segmentation_final.py` | 預測肺部區域（影像處理 + UNet + ResUNet） |
| `modify.h5` | UNet 模型權重 |
| `resunet.h5` | ResUNet 模型權重 |

---

## 🟢 Lung_Nodule_Segmentation
> 偵測並分割肺結節區域，結合 Mask R-CNN 與動態閾值法進行強化辨識。

<details>
<summary>📦 模型</summary>

| 檔案 | 功能說明 |
|------|-----------|
| `Mask_rcnn_trained_0711_2.h5` | Mask R-CNN 訓練模型 |
| `model1.pkl` | 多元線性回歸 (MLR) 模型，輸入平均值與起始HU值預測標準差 |

</details>

<details>
<summary>📂 其他檔案</summary>

| 檔案 | 功能說明 |
|------|-----------|
| `medical_image_preprocessing.py` | 醫學影像讀取與 HU 值轉換等預處理函式 |
| `metric.py` | 評估指標：Dice、Recall、Precision、F-measure |
| `dynamic_thresholding.py` | 產生動態閾值結果與分析 (MLR 預測 std → threshold = average - 2×std) |
| `image_processing.py` | 對動態閾值結果進行影像後處理（侵蝕1次 → 去除非起點區 → 膨脹1次） |
| `maskrcnn/` | Mask R-CNN 所需程式 |
| `Lung_Nodule_Segmentation_final.py` | 結節預測主程式 (整合 Dynamic Thresholding + Mask R-CNN) |

</details>

---

## 🔵 Invasiveness_Recognition
> 利用擷取的影像特徵進行侵襲性腫瘤辨識，採用 **BEED (Balanced Ensemble for Extreme Data Imbalance)** 方法處理不平衡資料問題。

| 檔案 | 功能說明 |
|------|-----------|
| `getfeature.py` | 特徵擷取 |
| `fea_sel.py` | 特徵選取 |
| `proposed_pro_wei.py` | BEED 模型訓練方法 (改善資料不平衡) |

---

## ⚙️ Full_Version

此資料夾為完整系統版本，包含：
- Web 平台與數據分析工具  
- 實驗結果範例影像  

> ⚠️ 由於安全與隱私考量，所有訓練資料與分析數據已刪除。  
> 部分影像僅供實驗結果展示，檔案路徑已被破壞，**無法直接執行**。

---

## 🧠 系統流程概述

```mermaid
graph TD
A[CT 影像輸入] --> B[Lung Segmentation]
B --> C[Lung Nodule Segmentation]
C --> D[特徵擷取 (getfeature.py)]
D --> E[特徵選取 (fea_sel.py)]
E --> F[侵襲性辨識 (BEED)]
F --> G[結果輸出與評估]

---

##  評估指標

* **Dice Coefficient**
* **Recall**
* **Precision**
* **F-measure**

---

##  技術摘要

| 模組   | 模型/方法                                               |
| ---- | --------------------------------------------------- |
| 肺部分割 | UNet + ResUNet                                      |
| 結節偵測 | Mask R-CNN + 動態閾值                                   |
| 特徵分析 | HU 值、紋理特徵、形態學特徵                                     |
| 分類方法 | BEED (Balanced Ensemble for Extreme Data Imbalance) |

---

##  環境需求

```bash
Python >= 3.8
TensorFlow >= 2.8
Keras >= 2.8
scikit-learn >= 1.0
pydicom
opencv-python
numpy
matplotlib
```

---

##  執行流程範例

```bash
# Step 1: 預處理影像
python medical_image_preprocessing.py

# Step 2: 肺部分割
python Lung_Segmentation_final.py

# Step 3: 結節偵測與分割
python Lung_Nodule_Segmentation_final.py

# Step 4: 特徵擷取與分類
python getfeature.py
python fea_sel.py
python proposed_pro_wei.py
```



